<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Self-Service Troubleshooter</title>
<style>
  :root{--bg:#f7f7f8;--card:#fff;--border:#e5e7eb;--text:#0a0a0a;--muted:#6b7280;--accent:#111}
  *{box-sizing:border-box}
  body{
    margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:#f59e0b;color:var(--text)
  }
  header{position:sticky;top:0;background:#fff7;backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--border);box-shadow:0 1px 0 rgba(0,0,0,.08);z-index:10}
  .wrap{max-width:1040px;margin:0 auto;padding:14px 16px;display:flex;gap:16px;align-items:center}
  h1{font-size:18px;margin:0;font-weight:700}
  .right{margin-left:auto;display:flex;gap:8px}
  .btn{padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer}
  .btn:hover{background:#f3f4f6}

  /* Tabs */
  .tabs{display:flex;gap:8px;margin-left:8px}
  .tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer}
  .tab:hover{background:#f3f4f6}
  .tab.is-active{background:#111;color:#fff;border-color:#111}

  .tab-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.tabs {
  display: flex;
  gap: 12px;
}

.right {
  margin-left: auto; /* schiebt JSON-Button ganz nach rechts */
}

  /* Views (nur eine sichtbar) */
  .view{display:none}
  .view.is-active{display:block}

  main{max-width:1040px;margin:0 auto;padding:24px 16px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 6px 16px rgba(0,0,0,.06);margin-bottom:22px}
  .kicker{font-size:11px;letter-spacing:.12em;color:var(--muted);font-weight:700;text-transform:uppercase}
  .section-title{display:flex;gap:8px;align-items:center;margin-bottom:10px;border-bottom:1px solid #e5e7eb;padding-bottom:8px}
  .section-title span:last-child{font-weight:bold;text-decoration:underline}
  .flex{display:flex;flex-wrap:wrap;gap:8px;max-height:260px;overflow:auto;padding-right:4px}
.chip{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border:1px solid var(--border);
  border-radius:999px;
  background:#f3f4f6;   /* <-- Helles Grau statt Wei√ü */
  cursor:pointer;
  white-space:nowrap;
  min-height:40px;
}
.chip:hover{
  background:#e5e7eb;   /* <-- Etwas dunkleres Grau beim Hover */
}
.chip.sel{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}
  .chip:focus-visible{box-shadow:0 0 0 3px rgba(37,99,235,.25)}
  .chip:active{transform:translateY(1px)}
  .input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px}
  .muted{color:var(--muted);font-size:14px}
  .result h3{margin:.25rem 0 .5rem;font-size:18px}
  .result ul{margin:.25rem 0 .9rem;padding-left:1.4rem;list-style:disc}
  footer{max-width:1040px;margin:0 auto;padding:24px 16px 40px;color:#fff;font-size:14px;text-align:center;text-shadow:0 1px 2px rgba(0,0,0,.3)}

  /* Bullets-Abstand */
  ul{list-style-position:outside;padding-left:2em}
  ul li{padding-left:.5em}

  /* einfache Tabelle f√ºr Seriennummer-Ansicht */
  table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;border:1px solid var(--border);background:#fff}
  th,td{padding:12px 14px;border-bottom:1px solid var(--border);text-align:left}
  tr:last-child td{border-bottom:none}
  th{background:#f9fafb;font-weight:600}
  .card h2 { margin-top:0; }

  /* Abstand zwischen Tabelle und "Wie sieht die Seriennummer aus?" */
/* Abstand √ºber dem Seriennummern-Block (zur Tabelle) */
#serials-look.mt-block { margin-top: 2rem; }
#serials-look {
  margin-top: 2rem; /* Abstand √ºber dem Block */
}

/* Leiste mit "Hersteller w√§hlen" im gleichen Stil/Abstand */
#serials-look .section-title {
  display: flex;
  align-items: center;
  gap: .75rem;
  margin: .5rem 0 1rem;
}

/* Button-Row: Wrap + Abst√§nde wie bei Ger√§tegruppe */
#serials-look .ts-group {
  display: flex;
  flex-wrap: wrap;
  gap: 12px 18px;     /* vertikal / horizontal an dein Layout anpassen */
  margin-bottom: 1rem;
}

/* zus√§tzlicher Abstand von Buttons zum Ergebnis-Kasten */
#brand-output { margin-top: 1rem; }

header { position: sticky; top: 0; /* hast du eh */ }
header { position: relative; }       /* wichtig f√ºr absolute Kind-Position */

.json-right{
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  gap: 8px;
  z-index: 2;        /* √ºber dem Header-Hintergrund */
}

/* Zebra-Streifen nur f√ºr Tabellen mit class="zebra" */
table.zebra { background: transparent; }
table.zebra tbody tr:nth-child(odd)  td { background: #fafafa; } /* hellgrau */
table.zebra tbody tr:nth-child(even) td { background: #ffffff; } /* wei√ü   */
table.zebra tbody tr:hover td         { background: #f0f2f5; }   /* Hover */
.btn-reset {
  background:#dc2626;      /* kr√§ftiges Rot (Tailwind Red-600) */
  color:#fff;
  font-weight:700;
  font-size:16px;
  padding:14px 24px;
  border-radius:14px;
  border:none;
  box-shadow:0 4px 12px rgba(0,0,0,.2);
  transition:background .2s ease, transform .05s ease;
}

.btn-reset:hover {
  background:#b91c1c;      /* dunkleres Rot beim Hover */
}

.btn-reset:active {
  transform:translateY(1px);
}
/* Hersteller-Tel: 2-Spalten-Layout */
.hotline-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:16px;
  align-items:stretch;   /* beide Boxen gleich hoch */
}
.list-scroll{ max-height:320px; overflow:auto; padding-right:4px; }
.detail-box{
  border:1px solid var(--border);
  border-radius:16px;
  background:#fff;
  padding:16px;
  min-height:220px;
}
#brandDetail .phone{
  font-size:22px; font-weight:800; margin:6px 0 10px;
}
.copy-btn{
  padding:10px 14px;
  border:1px solid var(--border);
  border-radius:12px;
  background:#f3f4f6;
  cursor:pointer;
}
.copy-btn:hover{ 
  background:#e5e7eb; 
}

/* Telefonnummern-Links global neutralisieren */
a[href^="tel:"]{
  color:#000 !important;            /* schwarz */
  text-decoration:none !important;  /* keine Unterstreichung */
  pointer-events:none;              /* nicht klickbar */
  cursor:default;                   /* kein Link-Cursor */
}

/* Telefonnummern Styling */
.phone {
  color: #000;             /* schwarz */
  font-weight: 600;        /* etwas fetter */
  text-decoration: none;   /* keine Unterstreichung */
  cursor: default;         /* kein Klick-Cursor */
}
th,td{padding:12px 14px;border-bottom:1px solid var(--border);text-align:left}
tr:last-child td{border-bottom:none}
th{background:#f9fafb;font-weight:600}

/* Zebra-Streifen f√ºr Tabellenzeilen */
table tr:nth-child(even) td {
  background-color: #f9fafb;
}
#flowStandard li {
  margin-bottom: 0;   /* Abstand entfernen */
}

#flowStandard li + li {
  margin-top: -1px;   /* sorgt daf√ºr, dass Boxen sauber aneinanderliegen */
}

/* nach jedem Kunden-Eintrag (also nach jeder geraden Zeile) gr√∂√üerer Abstand */
#flowStandard li:nth-child(even) {
  margin-bottom: 16px;
}
/* Gespr√§chsablauf: Rollenfarben */
#view-flow .role--mit { color:#dc2626; font-weight:700; } /* Mitarbeiter */
#view-flow .role--kun { color:#16a34a; font-weight:700; } /* Kunde */

.mitarbeiter {
  color: red;
  font-weight: bold;
}
.kunde {
  color: green;
  font-weight: bold;
}

/* Abstand nur nach Kunden-Zeilen */
.kunde-line {
  margin-bottom: 1rem; /* kannst du gr√∂√üer/kleiner machen */
}
/* Dialog: Mitarbeiter-Zeilen grau hinterlegen */
.dialog-gray{
  background:#f6f7f9;
  border-radius:6px;
  padding:6px 10px;
}
/* Dialog: Kunden-Zeilen wei√ü hinterlegen */
.dialog-white {
  background: #ffffff;
  border-radius: 6px;
  padding: 6px 10px;
  border: 1px solid #eee; /* feiner Rahmen, optional */
}

/* --- Views sichtbar/unsichtbar (nur falls nicht vorhanden) --- */
.view{display:none}
.view.is-active{display:block}

/* --- Arbeitsanweisungen UI --- */
.docs-toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.docs-auth{display:flex;align-items:center;gap:8px}
#docsPw{padding:10px;border:1px solid var(--border);border-radius:10px;min-width:220px;background:#fff}
.docs-admin{display:flex;gap:8px;margin:10px 0 16px}
.docs-list{list-style:none;margin:0;padding:0;display:grid;gap:10px}
.docs-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;border:1px solid var(--border);border-radius:12px;background:var(--card)}
.docs-actions{display:flex;gap:8px}
.btn-danger{background:#dc2626;color:#fff;border:none}
.btn-danger:hover{background:#b91c1c}

</style>
</head>
<body>
<header>
  <div class="wrap">
    <!-- links: Logo/Titel -->
    <h1>üõ†Ô∏è Self-Service</h1>

    <!-- deine Tabs -->
    <div class="tab-bar">
      <nav class="tabs">
        <button class="tab is-active" data-view="self">Troubleshooter</button>
        <button class="tab" data-view="sn">Seriennummern</button>
        <button class="tab" data-view="htel">Hersteller-Tel.</button>
        <button class="tab" data-view="dw">Durchwahlen</button>
        <button class="tab" data-view="flow">Gespr√§chsablauf</button>
        <button class="tab" data-view="docs">Arbeitsanweisungen</button>
      </nav>
    </div>
  </div>

  <!-- NEU: ganz rechts im Header, au√üerhalb der Wrap -->
  <div class="json-right">
    <button id="pickbtn" class="btn">JSON laden</button>
    <input id="pickfile" type="file" accept="application/json" hidden>
  </div>
</div>
</header>

<main>
  <!-- VIEW: Self-Service -->
  <div id="view-self" class="view is-active">
 <section class="card" style="display:flex;justify-content:space-between;align-items:flex-start;gap:16px;">
  <div>
    <h2>Willkommen beim Troubleshooter der PlusGarantie</h2>
    <ul>
      <li>W√§hlen Sie zun√§chst die passende <strong>Ger√§tegruppe</strong> und anschlie√üend das <strong>Symptom</strong>.</li>
      <li>Im Ergebnisbereich erscheinen m√∂gliche <strong>Ursachen</strong> und hilfreiche <strong>Selbsthilfe-Tipps</strong>.</li>
      <li>Mit <strong>‚ÄûZur√ºcksetzen‚Äú</strong> k√∂nnen Sie jederzeit wieder von vorne starten.</li>
    </ul>
  </div>
  <div>
 <button id="reset" class="btn btn-reset">Zur√ºcksetzen</button>
  </div>
</section>

    <section class="card">
      <div class="section-title"><span class="kicker">Schritt 1</span><span>Ger√§tegruppe w√§hlen</span></div>
      <div id="devices" class="flex"></div>
    </section>

    <section class="card">
      <div class="section-title"><span class="kicker">Schritt 2</span><span>Symptom w√§hlen</span></div>
      <input id="symSearch" class="input" placeholder="Symptom suchen (z. B. ‚Äûpumpt nicht ab‚Äú)" />
      <div id="symptoms" class="flex" style="margin-top:10px"></div>
      <p id="symHint" class="muted" style="margin-top:8px">Bitte zuerst ein Ger√§t ausw√§hlen.</p>
    </section>

    <section class="card">
      <div class="section-title"><span class="kicker">Ergebnis</span><span>Ursachen & Selbsthilfe‚ÄëTipps</span></div>
      <div id="result" class="result muted">Bitte Ger√§t und Symptom ausw√§hlen.</div>
    </section>
  </div>

  <!-- VIEW:  -->
  <div id="view-sn" class="view">
    <section class="card">
      <h2>Wo finde ich die Seriennummer?</h2>
      <table class="zebra">
        <tr><th>Ger√§tetyp</th><th>Position</th></tr>
        <tr><td>Waschmaschine / Trockner</td><td>T√ºrrahmen innen / T√ºrdichtung / R√ºckseite</td></tr>
        <tr><td>Geschirrsp√ºler</td><td>T√ºrseite innen / oberer T√ºrrahmen</td></tr>
        <tr><td>K√ºhlschrank / K√ºhl‚ÄëGefrier‚ÄëKombi</td><td>Innen‚ÄëSeitenwand / hinter Gem√ºsefach / R√ºckseite unten</td></tr>
        <tr><td>Herd / Backofen</td><td>Innen im T√ºrrahmen / hinter der unteren Schublade / R√ºckseite</td></tr>
        <tr><td>TV‚ÄëGer√§te</td><td>R√ºckseite / Men√º ‚ÄûInfo √ºber das Ger√§t‚Äú</td></tr>
      </table>

      <!-- Zusatzbereich: Wie sieht die Seriennummer aus? -->
<section id="serials-look">
  <h2>Wie sieht die Seriennummer aus?</h2>

  <!-- √úberschriftsleiste wie bei "Schritt 1" -->
  <div class="section-title">
    <span class="kicker">Hersteller w√§hlen</span>
  </div>

  <!-- Button-Row exakt wie im Troubleshooter -->
  <div id="brand-buttons" class="flex" role="tablist" aria-label="Hersteller w√§hlen"></div>

  <!-- Ergebnisbereich -->
  <div id="brand-output" class="result" aria-live="polite" aria-atomic="true"></div>
</section>
    </section>
  </div>

<!-- VIEW: Hersteller-Tel -->
<div id="view-htel" class="view">
  <section class="card">
    <h2>Hersteller-Hotline</h2>

    <div class="section-title">
      <span class="kicker">Suche</span>
      <span>Gib die Anfangsbuchstaben ein (z. B. ‚Äûbo‚Äú)</span>
    </div>
    <input id="brandSearch" class="input" placeholder="Anfangsbuchstaben eingeben ‚Ä¶" />

    <div class="hotline-grid">
      <!-- Linke Spalte: Trefferliste -->
      <div class="detail-box">
        <div class="section-title" style="margin-top:10px">
          <span class="kicker">Treffer</span><span>Hersteller ausw√§hlen</span>
        </div>
        <div id="brandList" class="flex list-scroll"></div>
        <p id="brandHint" class="muted">Bitte zuerst mindestens einen Buchstaben eingeben.</p>
      </div>

      <!-- Rechte Spalte: Detail -->
      <div class="detail-box">
        <div class="section-title" style="margin-top:10px">
          <span class="kicker">Telefon</span><span>Nummer & Kopieren</span>
        </div>
        <div id="brandDetail" class="muted">Noch kein Hersteller ausgew√§hlt.</div>
      </div>
    </div> <!-- Ende .hotline-grid -->

    <!-- NEU: √úbersicht nur hier -->
    <section class="card" style="margin-top:20px">
      <div class="section-title">
        <span class="kicker">√úbersicht</span>
        <span>Alle Hersteller & Nummern</span>
      </div>
      <div id="allHotlines"></div>
    </section>

  </section>
</div> <!-- Ende VIEW: Hersteller-Tel -->

<!-- ===== VIEW: Durchwahlen ===== -->
<div id="view-dw" class="view" style="display:none">
  <section class="card">
    <h2>Durchwahlen</h2>

    <div class="kicker" style="margin-bottom:6px;">Suche</div>
    <label for="dwQuery" style="font-weight:600; display:block; margin-bottom:6px;">
      Gib die Anfangsbuchstaben ein (z. B. ‚Äûmar‚Äú)
    </label>
    <input id="dwQuery" class="input" placeholder="Anfangsbuchstaben eingeben ‚Ä¶">

    <div class="grid2" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
      <!-- Treffer -->
      <div class="card" style="margin:0">
        <div class="kicker">Treffer</div>
        <div style="font-weight:600;margin:6px 0 10px">Namen ausw√§hlen</div>
        <div id="dwHits" class="muted">Bitte zuerst mindestens einen Buchstaben eingeben.</div>
      </div>

      <!-- Detail/Kopieren -->
      <div class="card" style="margin:0">
        <div class="kicker">Durchwahl</div>
        <div style="font-weight:600;margin:6px 0 10px">Nummer &amp; Kopieren</div>
        <div id="dwOut" class="muted">Noch keinen Namen ausgew√§hlt.</div>
      </div>
    </div>
  </section>

  <section class="card" style="margin-top:16px;">
    <div class="kicker">√úbersicht</div>
    <div style="font-weight:600;margin:6px 0 10px">Alle Durchwahlen</div>
    <div class="table-wrap" style="overflow:auto;">
      <table class="table" id="dwTable" style="width:100%;border-collapse:collapse">
        <thead>
          <tr>
            <th style="text-align:left;padding:10px 8px;border-bottom:1px solid var(--border)">Name</th>
            <th style="text-align:left;padding:10px 8px;border-bottom:1px solid var(--border)">K√ºrzel</th>
            <th style="text-align:left;padding:10px 8px;border-bottom:1px solid var(--border)">Durchwahl</th>
            <th style="text-align:right;padding:10px 8px;border-bottom:1px solid var(--border)">Aktion</th>
          </tr>
        </thead>
        <tbody id="dwTbody"></tbody>
      </table>
    </div>
  </section>
</div>

<!-- VIEW: Gespr√§chsablauf -->
<div id="view-flow" class="view">
  <section class="card">
    <h2>Gespr√§chsablauf</h2>

    <!-- Teil A: Standard-Dialog -->
    <div class="section-title">
      <span class="kicker">Standard</span>
      <span>Optimaler Dialog (Kurzleitfaden)</span>
    </div>
    <ol id="flowStandard" class="flow-dialog" style="margin-left:1.2rem; line-height:1.55;">
      <li>Mitarbeiter: Willkommen bei der Plusgarantie, wie kann ich Ihnen weiterhelfen?</li>
      <li>Kunde: Hallo, mein Ger√§t funktioniert nicht richtig.</li>
      <li>Mitarbeiter: Bitte geben Sie mir nochmals die <strong>Vertragsnummer</strong>, welche sie vorhin ins Telefon eingegeben haben.</li>
      <li>Kunde: Die Vertragsnummer lautet ‚Äû12345.1234567‚Äú </li>
      <li>Mitarbeiter: Vielen Dank, ich sehe <strong>Sie haben Ger√§t ‚ÄûX". Was genau funktioniert bei diesem Ger√§t nicht?</strong></li>
      <li>Kunde: ‚ÄûBesch√§digung des Kunden‚Äú</li>
      <li>Mitarbeiter: Haben Sie (‚Ä¶) und (‚Ä¶) ausprobiert? <strong>(Abfrage der L1-Tipps)</strong></li>
      <li>Kunde: Ja, nichts hat geholfen.</li>
      <li>Mitarbeiter: Dann w√ºrde ich noch gerne die <strong>Kundendaten</strong> mit Ihnen durchgehen. K√∂nnen sie mir bitte Ihren <strong>Vor- und Nachnamen</strong> sagen?</li>
      <li>Kunde: Vorname ‚ÄûMax‚Äú, Nachname ‚ÄûMustermann‚Äú.</li>
      <li>Mitarbeiter: Die <strong>Stra√üe</strong> in der sich das Ger√§t gerade befindet?</li>
      <li>Kunde: ‚ÄûMusterhausen 10‚Äú</li>
      <li>Mitarbeiter: Perfekt, wie lautet die <strong>Postleitzahl</strong>?</li>
      <li>Kunde: ‚Äû1234‚Äú</li>
      <li>Mitarbeiter: Darf ich Ihre <strong>Telefonnummer</strong>, mit der Sie gerade anrufen gleich kopieren?</li>
      <li>Kunde: Ja (dann Telefonnummer vom Display EINTIPPEN INS SYSTEM)</li>
      <li>Mitarbeiter: Darf ich bitte noch Ihre <strong>E-Mail-Adresse</strong> notieren?</li>
      <li>Kunde: ‚Äûmax.mustermann@gmail.com‚Äú</li>
    </ol>

    <!-- Teil B: Branching-Buttons -->
    <div class="section-title" style="margin-top:14px">
      <span class="kicker">Vertiefung</span>
      <span>nach Ger√§tegruppe</span>
    </div>
    <div id="flowCats" class="flex" style="max-height:none">
      <button class="chip" data-cat="weiss">Weissware</button>
      <button class="chip" data-cat="tv">TV</button>
      <button class="chip" data-cat="klein">Kleinger√§te</button>
    </div>

    <!-- Fortsetzung wird hier angezeigt -->
    <div id="flowDetail" class="card" style="margin-top:12px">
      <div class="muted">Bitte eine Produktgruppe oben w√§hlen.</div>
    </div>
  </section>
</div>

<!-- ===== VIEW: Arbeitsanweisungen ===== -->
<div id="view-docs" class="view">
  <section class="card">
    <div class="section-title">
      <span class="kicker">PDFs</span><span>Arbeitsanweisungen</span>
    </div>

    <!-- Leiste oben rechts: Status + Passwort/Login -->
    <div class="docs-toolbar">
      <span id="docsStatus" class="muted">Nur-Lesen</span>
      <div class="docs-auth">
        <input id="docsPw" type="password" placeholder="Passwort eingeben">
        <button id="docsLogin" class="btn">Anmelden</button>
        <button id="docsLogout" class="btn" style="display:none">Abmelden</button>
      </div>
    </div>

    <!-- Admin-Bereich (nur nach Login sichtbar) -->
    <div id="docsAdmin" class="docs-admin" style="display:none">
      <input id="docsUpload" type="file" accept="application/pdf" multiple>
      <button id="docsAdd" class="btn">Hochladen</button>
    </div>

    <!-- Liste f√ºr alle sichtbar -->
    <ul id="docsList" class="docs-list"></ul>
  </section>
</div>
</main>

<footer>¬© <span id="yr"></span> ‚Äì 2025 AQILO ‚Äì LIFE IS JUST A GAME ‚Äì</footer>

<script>
  // L√§dt JSON sicher. Bei file:// gibt's einfach null statt CORS-Fehler.
async function loadJsonSafe(url) {
  if (location.protocol === 'file:') return null;  // fetch bei file:// blockieren
  try {
    const res = await fetch(url, { cache: 'no-store' });
    if (!res.ok) return null;
    return await res.json();
  } catch {
    return null;
  }
}
/* ===== Kurz‚ÄëUtilities ===== */
const $ = s => document.querySelector(s);
const normalize = s => (s||"").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"");

/* ===== Validierung ===== */
function validateData(json){
  if (!Array.isArray(json)) throw new Error("Root muss ein Array sein");
  json.forEach(d=>{
    if (typeof d.device!=="string" || !Array.isArray(d.items)) throw new Error("Ung√ºltiges Device-Objekt");
    d.items.forEach(i=>{
      if (typeof i.symptom!=="string" || !Array.isArray(i.causes) || !Array.isArray(i.tips)){
        throw new Error("Ung√ºltiger Item-Eintrag");
      }
    });
  });
}

/* ===== Demo‚ÄëFallback ===== */
const DEMO = [
  {"device":"Geschirrsp√ºler","items":[
    {"symptom":"pumpt nicht ab","causes":["Fremdk√∂rper in der Pumpe","Ablauf verstopft / blockiert"],"tips":["Siebe kontrollieren und reinigen","Ablaufschlauch am Syphon l√∂sen (ACHTUNG! Druck!)","Ablaufschlauch auf Knicke pr√ºfen"]},
    {"symptom":"w√§scht nicht sauber","causes":["Falsche Dosierung","Falsche Einstellung"],"tips":["Dosierung & Wasserh√§rte gem√§√ü Anleitung einhalten"]}
  ]},
  {"device":"Herd","items":[{"symptom":"Kochplatte/Rohr geht nicht","causes":["Uhr nicht eingestellt"],"tips":["Uhr einstellen"]}]},
  {"device":"Kaffeemaschine","items":[
    {"symptom":"es kommt kein Wasser","causes":["Verkalkt","Verstopft"],"tips":["Entkalkungs-/Reinigungsprogramm","Ausl√§sse reinigen"]},
    {"symptom":"Milchsch√§umer geht nicht","causes":["Verstopft"],"tips":["√ñffnung mit Pfeifenreiniger reinigen"]}
  ]},
  {"device":"K√ºhlschrank","items":[{"symptom":"Wasser steht im Ger√§t","causes":["Abtaurinne verstopft"],"tips":["Abfluss√∂ffnung reinigen"]}]},
  {"device":"TV","items":[
    {"symptom":"Bild farbfleckig","causes":["Clouding"],"tips":["Auf gute Bel√ºftung achten"]},
    {"symptom":"Bild hat Farbstich","causes":["HDMI/Scart defekt","Zuspielger√§t defekt"],"tips":["Anderes Kabel/Ger√§t/Eingang testen"]},
    {"symptom":"kein Bild","causes":["HDMI/Scart defekt","Zuspielger√§t defekt","Karte aktiv?"],"tips":["Anderes Kabel/Ger√§t/Eingang testen"]}
  ]},
  {"device":"Waschmaschine","items":[
    {"symptom":"pumpt nicht ab","causes":["Fremdk√∂rper im Flusensieb","Ablauf verstopft/Blockade"],"tips":["Flusensieb reinigen (ACHTUNG: Restwasser!)","Ablaufschlauch auf Knicke pr√ºfen"]},
    {"symptom":"h√ºpft beim Schleudern","causes":["Ger√§t steht nicht richtig","Transportsicherungen","Unwucht"],"tips":["Ger√§t ausrichten","Transportsicherungen entfernen","W√§schemenge anpassen"]}
  ]},
  {"device":"Trockner","items":[{"symptom":"zeigt ‚ÄûBeh√§lter voll‚Äú","causes":["Flusensiebe verstopft"],"tips":["Siebe reinigen"]}]}
];

/* ===== State ===== */
let DATA = DEMO.slice();
let selectedDevice = null;
let selectedSymptom = null;
let symQuery = "";

/* ===== Rendering ===== */
function renderDevices(){
  const box = $("#devices"); if(!box) return; box.innerHTML = "";
  [...DATA.map(d=>d.device)].sort((a,b)=>a.localeCompare(b)).forEach(name=>{
    const b = document.createElement("button");
    b.className = "chip"+(selectedDevice===name?" sel":"");
    b.textContent = name;
    b.onclick = ()=>{
      selectedDevice=name; selectedSymptom=null; symQuery=""; const s=$("#symSearch"); if(s) s.value="";
      renderDevices(); renderSymptoms(); renderResult();
    };
    box.appendChild(b);
  });
}
function listSymptoms(){
  const dev = DATA.find(d=>d.device===selectedDevice);
  if (!dev) return [];
  let items = dev.items;
  if (symQuery){
    const q = normalize(symQuery);
    items = items.filter(i => normalize(i.symptom).includes(q));
  }
  return [...items].sort((a,b)=>a.symptom.localeCompare(b.symptom));
}
function renderSymptoms(){
  const hint = $("#symHint"); const box = $("#symptoms"); if(!box) return; box.innerHTML = "";
  if (hint) hint.style.display = selectedDevice ? "none" : "block";
  if (!selectedDevice) return;
  listSymptoms().forEach(i=>{
    const b = document.createElement("button");
    b.className = "chip"+(selectedSymptom===i.symptom?" sel":"");
    b.textContent = i.symptom;
    b.onclick = ()=>{ selectedSymptom=i.symptom; renderSymptoms(); renderResult(); };
    box.appendChild(b);
  });
}
function renderResult(){
  const out = $("#result"); if(!out) return;
  if (!selectedDevice || !selectedSymptom){
    out.classList.add("muted");
    out.textContent = "Bitte Ger√§t und Symptom ausw√§hlen.";
    return;
  }
  const dev = DATA.find(d=>d.device===selectedDevice);
  const item = dev?.items.find(i=>i.symptom===selectedSymptom);
  if (!item){ out.textContent = "Keine Daten gefunden."; return; }
  out.classList.remove("muted");
  out.innerHTML = `
    <h3>üîß ${selectedDevice} ‚Äì ${selectedSymptom}</h3>
    <strong>M√∂gliche Ursachen</strong>
    <ul>${item.causes.map(c=>`<li>${c}</li>`).join("")}</ul>
    <strong>Selbsthilfe-Tipps</strong>
    <ul>${item.tips.map(t=>`<li>${t}</li>`).join("")}</ul>
    ${item.info ? `<div class="muted" style="margin-top:.5rem">${item.info}</div>` : ""}
  `;
}

// Wie sieht die Seriennummer aus
// === exakt wie der Troubleshooter ===
const BUTTON_CLASS = 'chip';     // Pill-Buttons
const ACTIVE_CLASS = 'sel';      // aktiver Zustand: .chip.sel (schwarz/wei√ü)

// 12 Hersteller A‚ÄìL mit Beispiel-Seriennummern und Text
const BRANDS = [
  { name: 'AEG/Electrolux', sn: '05133587 und 916098529/01', txt: 'Gibt SN und Prod. No. ‚Äì am besten beide notieren' },
  { name: 'Bauknecht', sn: '341949039921 und 858350803050', txt: 'Gibt S/N und 2. Nummer ist immer dr√ºber ' },
  { name: 'Beko', sn: '18-801727-10', txt: '2 Zahlen dann ‚Äì Zahlen dann ‚Äì und endet mit 2 Zahlen' },
  { name: 'BSH: Bosch, Siemens, Neff', sn: 'E: WT 45 RVA 1/02 FD:9912 Z:200987', txt: 'Gibt E-Nummer, FD Nummer und Z-Nr.' },
  { name: 'Candy-Hoover', sn: '3100829619460061', txt: 'Hei√üt N: und dann nur Zahlen ' },
  { name: 'Gorenje', sn: '92931480 und 735141/01', txt: 'Gibt Ser.No.: und ART.No.: - am besten beide notieren' },
  { name: 'Grundig', sn: 'G4L11S009382001J', txt: 'X' },
  { name: 'Haier', sn: 'B70U31E1G00BAKBS0012', txt: 'Serial Number ‚Äì beginnt mit mind. 2 Buchstaben und dann folgen Zahlen und Buchstaben' },
  { name: 'LG', sn: '801PNRT01958', txt: 'Beginnt immer mit 3 Zahlen und endet mit 3 Zahlen' },
  { name: 'Miele', sn: '17/149397598', txt: 'Nr.: - beginnt mit 2 Zahlen dann / , folgen nur noch Zahlen' },
  { name: 'OK/Koenic', sn: '9Z29D168700101904110592', txt: 'Unter Strichcode' },
  { name: 'Panasonic', sn: 'NV-8560402', txt: 'Beginnt immer mit 2 Buchstaben, dann folgen Zahlen' },
  { name: 'Philips', sn: 'FZ1A1913024693', txt: 'Beginnt immer mit FZ ' },
  { name: 'Samsung', sn: '0FT53HIN700763P', txt: 'Beginnt immer mit 0 oder B0 und endet mit einem Buchstaben ' },
  { name: 'Sony', sn: '6000268', txt: 'Ser.No. ‚Äì beginnt immer mit 60 und ist 7-stellig' },
];

function initSerialLookSection() {
  const row = document.getElementById('brand-buttons');
  const out = document.getElementById('brand-output');
  if (!row || !out) return;

  // Buttons bauen
  BRANDS.forEach((b, i) => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = BUTTON_CLASS + (i === 0 ? ' ' + ACTIVE_CLASS : '');
    btn.textContent = b.name;
    btn.setAttribute('role', 'tab');
    btn.setAttribute('aria-selected', i === 0 ? 'true' : 'false');

    btn.addEventListener('click', () => {
      // Active-State wie im Troubleshooter: .chip.sel
      row.querySelectorAll('button').forEach(el => {
        el.classList.remove(ACTIVE_CLASS);
        el.setAttribute('aria-selected', 'false');
      });
      btn.classList.add(ACTIVE_CLASS);
      btn.setAttribute('aria-selected', 'true');
      renderBrand(out, b);
    });

    row.appendChild(btn);
  });

  // erste Auswahl zeigen
  renderBrand(out, BRANDS[0]);
}

function renderBrand(container, brand) {
  container.innerHTML = `
    <div class="card">
      <p><strong>Beispiel-Seriennummer (${brand.name}):</strong> ${brand.sn}</p>
      <p>${brand.txt}</p>
    </div>
  `;
}

// initialisieren, sobald DOM steht
document.addEventListener('DOMContentLoaded', initSerialLookSection);


/* ===== Hersteller-Suche/Anzeige ===== */
let brandQuery = "";
let selectedBrand = null;

function filterBrands(q){
  const nq = normalize((q || "").replace(/\s+/g," ").trim());
  if(!nq) return [];
  return HOTLINES
    .slice()
    .filter(b => normalize(b.name).startsWith(nq))
    .sort((a,b)=> a.name.localeCompare(b.name));
}

function renderBrandList(){
  const box  = document.getElementById('brandList');
  const hint = document.getElementById('brandHint');
  if(!box) return;

  box.innerHTML = "";
  const items = filterBrands(brandQuery);

  hint && (hint.style.display = brandQuery ? "none" : "block");
  if(!brandQuery) return;

  if(items.length === 0){
    const p = document.createElement('p');
    p.className = 'muted';
    p.textContent = 'Keine Treffer. Tipp: nur Anfangsbuchstaben (z. B. ‚Äûbo‚Äú).';
    box.appendChild(p);
    return;
  }

  items.forEach(b=>{
    const btn = document.createElement('button');
    btn.className = 'chip' + (selectedBrand?.name === b.name ? ' sel' : '');
    btn.textContent = b.name;
    btn.onclick = ()=>{ selectedBrand = b; renderBrandList(); renderBrandDetail(); };
    box.appendChild(btn);
  });
}

function renderBrandDetail(){
  const out = document.getElementById('brandDetail');
  if(!out) return;

  if(!selectedBrand){
    out.classList.add('muted');
    out.textContent = 'Noch kein Hersteller ausgew√§hlt.';
    return;
  }

  out.classList.remove('muted');
  out.innerHTML = `
    <div><strong>Hersteller:</strong><br>${selectedBrand.name}</div>
    <div class="phone">${selectedBrand.phone || '‚Äì'}</div>
    ${selectedBrand.phone ? `
      <button class="copy-btn" id="copyPhone">Nummer kopieren</button>
    ` : `<div class="muted">Keine Nummer hinterlegt.</div>`}
  `;

  document.getElementById('copyPhone')?.addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(selectedBrand.phone);
      const btn = document.getElementById('copyPhone');
      const old = btn.textContent;
      btn.textContent = 'Kopiert ‚úì';
      setTimeout(()=> btn.textContent = old, 1200);
    }catch{}
  });
}

// Eingabefeld √ºberwachen
document.addEventListener('input', (e)=>{
  if(e.target && e.target.id === 'brandSearch'){
    brandQuery = e.target.value;
    selectedBrand = null;
    renderBrandList();
    renderBrandDetail();
  }
});

/* ===== daten.json automatisch laden (wenn vorhanden) ===== */
async function tryLoadJson() {
  const json = await loadJsonSafe("daten.json?cb=" + Date.now());
  if (json) {
    try {
      validateData(json);
      DATA = json;
      console.log("daten.json geladen ‚úÖ");
      return;
    } catch (e) {
      console.warn("daten.json ung√ºltig ‚Äì Demo-Daten aktiv.");
    }
  } else {
    console.warn("daten.json √ºbersprungen (file://) oder nicht gefunden ‚Äì Demo-Daten aktiv.");
  }
  DATA = DEMO.slice(); // Fallback
}


/* ===== Datei-Picker (optional) ===== */
function readJsonFile(file){
  return new Promise((resolve,reject)=>{
    const fr=new FileReader();
    fr.onload=()=>{ try{ const j=JSON.parse(fr.result); validateData(j); resolve(j); }catch(e){ reject(e); } };
    fr.onerror=()=>reject(fr.error);
    fr.readAsText(file,"utf-8");
  });
}
$("#pickbtn")?.addEventListener("click", ()=> $("#pickfile").click());
$("#pickfile")?.addEventListener("change", async e=>{
  const f = e.target.files?.[0]; if(!f) return;
  try{
    DATA = await readJsonFile(f);
    selectedDevice=null; selectedSymptom=null; symQuery=""; const s=$("#symSearch"); if(s) s.value="";
    renderDevices(); renderSymptoms(); renderResult();
    alert("JSON geladen ‚úÖ");
  }catch(err){ alert("JSON ung√ºltig: " + (err?.message || err)); }
  finally{ e.target.value=""; }
});

$("#reset").addEventListener("click", ()=>{
  selectedDevice=null; selectedSymptom=null; symQuery=""; const s=$("#symSearch"); if(s) s.value="";
  renderDevices(); renderSymptoms(); renderResult();
});
$("#symSearch")?.addEventListener("input", e=>{ symQuery=e.target.value; renderSymptoms(); });

/* ===== Tabs: sichere Umschaltung √ºber Klassen ===== */
function showView(which){
  const self = document.getElementById('view-self');
  const sn   = document.getElementById('view-sn');
  const htel = document.getElementById('view-htel');
  const dw   = document.getElementById('view-dw');
  const flow = document.getElementById('view-flow');   // Gespr√§chsablauf
  const docs = document.getElementById('view-docs');
  // nur noch diese Views!
  const views = { self, sn, htel, dw, flow, docs };

  // Sichtbarkeit umschalten
  Object.entries(views).forEach(([key, el])=>{
    if (!el) return;
    el.classList.toggle('is-active', key === which);
  });

  // Aktiven Tab markieren
  document.querySelectorAll('.tab')
    .forEach(t => t.classList.toggle('is-active', t.dataset.view === which));

  // URL-Hash aktualisieren (Service raus)
  history.replaceState(null,'',
    which==='self' ? '#selfservice'  :
    which==='sn'   ? '#seriennummer' :
    which==='htel' ? '#hersteller'   :
    which==='dw'   ? '#durchwahlen'  :
    which==='flow' ? '#gespraech'    :
    which==='docs' ? '#documente'    :
    '#self'
  );
}

document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=> showView(btn.dataset.view));
});
// Beim Laden: Hash beachten
(function(){
  const hash = location.hash.toLowerCase();
  if      (hash.includes('selfservice')) showView('self');
  else if (hash.includes('seriennummer')) showView('sn');
  else if (hash.includes('hersteller'))   showView('htel');
  else if (hash.includes('durchwahlen'))   showView('dw');
  else if (hash.includes('gespraech'))    showView('flow');
  else if (hash.includes('documente'))    showView('docs');
  else showView('self');
})();
// ===== Hersteller-Hotlines (Basis) =====
// ===== Hersteller-Hotlines (vollst√§ndig) =====
let HOTLINES = [
  { name:"AEG",                   phone:"0911 323 21 10" },
  { name:"Amica",                 phone:"02593 95 67 200" },
  { name:"Bauknecht / Privileg",  phone:"0711 8888 900" },
  { name:"Beko",                  phone:"06102 868 68 91" },
  { name:"Blomberg",              phone:"06102 86 86 89 2" },
  { name:"Bomann",                phone:"02152 9939111" },
  { name:"Bosch",                 phone:"089 69 339 339" },
  { name:"Candy / Hoover",        phone:"01806 62 55 62" },
  { name:"Caso",                  phone:"02932 80 554 0" },
  { name:"Comfee (Midea)",        phone:"06196 90 200" },
  { name:"Dyson",                 phone:"0800 31 31 318" },
  { name:"Electrolux / AEG",      phone:"0911 323 21 10" },
  { name:"Exquisit (EGS)",        phone:"02944 97 166" },
  { name:"Gorenje",               phone:"089 200 06 32 32" },
  { name:"Grundig TV",            phone:"0911 59 05 97 30" },
  { name:"Grundig WW",            phone:"06102 86 86 893" },
  { name:"Haier",                 phone:"0211 418 73 140" },
  { name:"Haier TV",              phone:"01805 059 060" },
  { name:"Hisense TV",            phone:"089 2000 63 252" },
  { name:"Hisense WW",            phone:"089 2000 63 251" },
  { name:"Jay-Tech",              phone:"02161 575 890" },
  { name:"JTC",                   phone:"02161 575 890 oder 02161 575 8950 bei techn. Fragen" },
  { name:"Jura",                  phone:"0180 35 23 333" },
  { name:"Koenic",                phone:"0800 7246 878" },
  { name:"Lenco",                 phone:"02153 121 69 19" },
  { name:"LG",                    phone:"0800 45 444 45" },
  { name:"Liebherr",              phone:"0800 583 60 03" },
  { name:"Loewe",                 phone:"09261 99 500 geht nicht mehr" },
  { name:"Midea",                 phone:"06196 90 200" },
  { name:"Miele",                 phone:"0800 22 44 666" },
  { name:"NEFF",                  phone:"089 124 74 474" },
  { name:"OK.",                   phone:"0800 499 4998" },
  { name:"Panasonic",             phone:"040 5555 88 55" },
  { name:"PEAQ",                  phone:"0800 777 222 6" },
  { name:"Philips / Saeco",       phone:"040 8080 10 980" },
  { name:"PKM",                   phone:"02841 999 49 72" },
  { name:"Respekta",              phone:"062 36 46 320" },
  { name:"Samsung",               phone:"0800 72 67 864 oder 06196 77 555 77" },
  { name:"Schneider",             phone:"" }, // keine Nummer ‚Üí ‚Äû‚Äî‚Äú
  { name:"Severin",               phone:"0800 44 33 500" },
  { name:"Siemens",               phone:"089 21 751 751" },
  { name:"Sharp",                 phone:"089 896 58 758" },
  { name:"Sony",                  phone:"0303 464 90 59" },
  { name:"Strong",                phone:"0180 501 4991" },
  { name:"TCL",                   phone:"0211 33 99 59 66" },
  { name:"Telefunken",            phone:"069 6000" },
  { name:"Toshiba",               phone:"089 12 22 32 032" },
  { name:"Vestel",                phone:"089 211 29 555" },
  { name:"Xiaomi",                phone:"0800 223 11 44" },
  { name:"Zanussi",               phone:"0911 323 2110" }
];

// hilft beim sicheren Einf√ºgen von Text
function escapeHtml(s){
  const d=document.createElement('div'); d.innerText=String(s ?? ''); return d.innerHTML;
}

// komplette Herstellerliste unten rendern
function renderAllHotlinesList(list = HOTLINES){
  const host = document.getElementById('allHotlines');
  if(!host) return;

  const rows = (list||[])
    .filter(x => x && x.name) // auch ohne Nummer anzeigen
    .slice()
    .sort((a,b)=> a.name.localeCompare(b.name, 'de'));

  if(rows.length === 0){
    host.innerHTML = '<p class="muted">Keine Hotlines vorhanden.</p>';
    return;
  }

host.innerHTML = `
  <table class="table-hotlines">
    <thead>
      <tr><th>Hersteller</th><th>Telefon</th><th>Aktion</th></tr>
    </thead>
  
<tbody>
  ${rows.map(entry => `
    <tr>
      <td>${entry.name}</td>
      <td>${entry.phone}</td>
      <td><button class="copy-btn" data-phone="${entry.phone}">Kopieren</button></td>
    </tr>`).join('')}
</tbody>
    </table>
  `;

  // ‚ÄûKopieren‚Äú-Buttons (Event-Delegation)
  host.addEventListener('click', (ev)=>{
    const btn = ev.target.closest('.copy-btn'); if(!btn) return;
    navigator.clipboard.writeText(btn.dataset.phone || '');
    const old = btn.textContent; btn.textContent = 'Kopiert ‚úì';
    setTimeout(()=> btn.textContent = old, 1200);
  }, { once:true });
}

// ===== Gespr√§chsablauf: vertiefende Dialoge =====
const FLOW_TEXT = {
  weiss: [
    "Mitarbeiter: K√∂nnten Sie mir bitte noch die <strong>Seriennummer</strong> sagen?",
    "Kunde: ‚Äû12345678‚Äú.",
    "Mitarbeiter: Bitte beachten Sie: Sollte sich bei der Pr√ºfung zeigen, dass <strong>kein versicherter Schaden</strong> vorliegt, √ºbernimmt die Versicherung die Kosten leider nicht!",
    "Kunde: Woher wei√ü ich ob mein Schaden versichert ist?",
    "Mitarbeiter: Nicht versichert sind Sch√§den durch <strong>Eigenverschulden</strong>, wie etwa wenn ein Fremdk√∂rper ins Ger√§t gelangt. (Waschmaschine)",
    "Kunde: Aso okay, jetzt kenne ich mich aus.",
    "Mitarbeiter: Dankesch√∂n, ich w√ºnsche Ihnen noch einen sch√∂nen Tag!",
  ],
  tv: [
    "Mitarbeiter: K√∂nnten Sie mir bitte noch die <strong>Seriennummer</strong> sagen?",
    "Kunde: ‚Äû12345678‚Äú.",
    "Mitarbeiter:  Ich leite jetzt alles an den Servicebetrieb weiter, der wird Sie wegen eines Reparaturtermins kontaktieren. Falls ein <strong>Leihger√§t</strong> vorhanden ist, h√§tten Sie Interesse daran?",
    "Kunde: Ja/Nein",
    "Mitarbeiter: Bitte beachten Sie: Sollte sich bei der Pr√ºfung zeigen, dass <strong>kein versicherter Schaden</strong> vorliegt, √ºbernimmt die Versicherung die Kosten leider nicht!",
    "Kunde: Woher wei√ü ich ob mein Schaden versichert ist?",
    "Mitarbeiter: Nicht versichert sind Sch√§den durch <strong>Eigenverschulden</strong>, wie etwa wenn ein Fremdk√∂rper ins Ger√§t gelangt. (Waschmaschine)",
    "Kunde: Aso okay, jetzt kenne ich mich aus.",
    "Mitarbeiter: Dankesch√∂n, ich w√ºnsche Ihnen noch einen sch√∂nen Tag!",
  ],
  klein: [
    "Mitarbeiter: Einen Moment bitte, ich lege den Schaden kurz an und gebe Ihnen gleich Ihre <strong>Bearbeitungsnummer</strong>.",
    "Kunde: Ja passt.",
    "Mitarbeiter: Die Nummer lautet ‚Äûxxxxxxxx‚Äú",
    "Kunde: Okay danke.",
    "Mitarbeiter: Bei <strong>Kleinger√§ten</strong>, wie einer Kaffeemaschine gehen Sie bitte mit der Rechnung zu einem  <strong>MediaMarkt oder Saturn</strong> in Ihrer N√§he. Wenden Sie sich dort an den Servicemitarbeiter neben den Kassen. Das Ger√§t wird dann gepr√ºft und f√ºr die Reparatur an den Servicebetrieb geschickt. F√ºr Kleinger√§te ist dieser Weg leider notwendig. ",
    "Kunde: Kein Problem.",
    "Mitarbeiter: Dankesch√∂n, ich w√ºnsche Ihnen noch einen sch√∂nen Tag!",
  ]
};

function renderFlowDetail(cat){
  const box = document.getElementById('flowDetail');
  if(!box) return;
  const lines = FLOW_TEXT[cat];
  if(!lines){
    box.innerHTML = '<div class="muted">Bitte eine Produktgruppe oben w√§hlen.</div>';
    return;
  }
  box.innerHTML = `
    <strong>Fortsetzung ‚Äì ${cat==='weiss'?'Weissware':cat==='tv'?'TV':'Kleinger√§te'}</strong>
    <ol style="margin-left:1.2rem; line-height:1.55; margin-top:.5rem;">
      ${lines.map(li=>{
         const lower = li.trim().toLowerCase();
         const cls = lower.startsWith("mitarbeiter") ? "dialog-gray" :
              lower.startsWith("kunde") ? "dialog-white" : "";
        return `<li class="${cls}">${li}</li>`;
          }).join('')}
    </ol>
  `;
  colorizeRolesIn(box);
}

// Klicks auf die drei Chips explizit binden
function setupFlowClicks(){
  const chips = document.querySelectorAll('#flowCats .chip');
  chips.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      chips.forEach(b=>b.classList.remove('sel'));
      btn.classList.add('sel');
      renderFlowDetail(btn.dataset.cat);
    });
  });
}

// f√§rbt nur die Worte "Mitarbeiter" und "Kunde" im √ºbergebenen Container
function colorizeRolesIn(root){
  if(!root) return;
  const walk = (node)=>{
    if(node.nodeType===3){ // Text
      let text=node.textContent;
      let replaced=false;

      if(text.includes("Mitarbeiter:")){
        text=text.replace("Mitarbeiter:", "<span class='mitarbeiter'>Mitarbeiter:</span>");
        replaced=true;
      }
      if(text.includes("Kunde:")){
        text=text.replace("Kunde:", "<span class='kunde'>Kunde:</span>");
        // <li> bekommt Extra-Klasse f√ºr Abstand
        if(node.parentElement && node.parentElement.tagName==="LI"){
          node.parentElement.classList.add("kunde-line");
        }
        replaced=true;
      }
      if(replaced){
        const span=document.createElement("span");
        span.innerHTML=text;
        node.replaceWith(span);
      }
    } else {
      node.childNodes.forEach(walk);
    }
  };
  walk(root);
}

function markMitarbeiterRows(root = document){
  // Bevorzugt nur Dialog-Container; sonst alle <li>
  const candidates = root.querySelectorAll('#dialog li, .dialog li, .dialog-list li');
  const items = candidates.length ? candidates : root.querySelectorAll('li');

  items.forEach(li => {
    // Zeilentext normalisieren
    const txt = li.textContent.replace(/\s+/g,' ').trim().toLowerCase();

    // Erkennen, ob die Zeile mit "Mitarbeiter:" oder "Kunde:" beginnt
    const isMitarbeiter = /^(?:\d+\.\s*)?mitarbeiter\s*:/.test(txt);
    const isKunde       = /^(?:\d+\.\s*)?kunde\s*:/.test(txt);

    // Klassen setzen/entfernen
    li.classList.toggle('dialog-gray',  isMitarbeiter);
    li.classList.toggle('dialog-white', isKunde);
  });
  
}
// F√§rbt alle li in root: Mitarbeiter -> grau, Kunde -> wei√ü
function paintListByRole(root){
  if(!root) return;
  root.querySelectorAll('li').forEach(li=>{
    // robust gegen Nummerierung "1. ", Leerzeichen und fett/Spans
    const t = li.textContent.trim().toLowerCase();
    const m = t.match(/^(\d+\.\s*)?\s*(mitarbeiter|kunde)\s*:/);
    const role = m ? m[2] : null;

    li.classList.toggle('dialog-gray',  role === 'mitarbeiter');
    li.classList.toggle('dialog-white', role === 'kunde');
  });
}
function markAllDialogBlocks(){
  document.querySelectorAll('.flow-dialog').forEach(block => paintListByRole(block));
}


/* ===== Init ===== */
(async function init(){
  $("#yr").textContent = new Date().getFullYear();
await tryLoadJson();

renderDevices(); 
renderSymptoms(); 
renderResult();

// Hersteller-UI initial rendern
renderBrandList();
renderBrandDetail();
colorizeRolesIn(document.getElementById('flowStandard'));
})();
renderAllHotlinesList();   // ‚Üê baut die Karte unten

/* ===== Durchwahlen ‚Äì statisch im Skript (ohne JSON) ===== */
(function(){
  // 1) HIER DEINE DURCHWAHLEN
  const DW = [
    { name: 'Thomas Novak (AUT)',  code: 'tomnov',      phone: '61' },
    { name: 'Martin Kasika (AUT)',   code: 'markas',   phone: '69' },
    { name: 'Regina Schauberger (AUT)',   code: 'regsch',     phone: '25' },
    { name: 'Angela Franso (AUT)', code: 'angfra',  phone: '34' },
    { name: 'Michael Richter (AUT)',     code: 'micric',    phone: '50' },
    { name: 'Jasmin Bascha (AUT)',    code: 'jasert',   phone: '51' },
    { name: 'Andreas Ruisz (AUT)',  code: 'andrui',  phone: '54' },
    { name: 'Marvin Jonas (AUT)',   code: 'marjon',phone: '55' },
    { name: 'Daniela Hoheneder (AUT)',  code: 'danhoh',      phone: '59' },
    { name: 'Christian Hartl (AUT)',   code: 'chrhar',   phone: '67' },
    { name: 'Manuel Gruber (AUT) ',   code: 'mangru',     phone: '501' },
    { name: 'Juliane Kosch (AUT)', code: 'julkos',  phone: '503' },
    { name: 'Manuel Stanonik (AUT)',     code: 'mansta',    phone: '506' },
    { name: 'Sophie Kriwan (AUT)',    code: 'sopkri',   phone: '507' },
    { name: 'Jaqueline Tr√ºmmel (AUT)',  code: 'jaqtru',  phone: '511' },
    { name: 'Markus Vranovsky (AUT)',   code: 'marvra',phone: '513' },
    { name: 'Kevin Tasan (AUT)',  code: 'kevtas',      phone: '514' },
    { name: 'Cornelia Marton (AUT)',   code: 'cormar',   phone: '516' },
    { name: 'Alyin Pintul (AUT)',   code: 'alypin',     phone: '518' },
    { name: 'Stefan Macher (AUT)', code: 'stemac',  phone: '520' },
    { name: 'Sebastian Springer (AUT)',     code: 'sebspr',    phone: '521' },
    { name: 'Emina Isakovic (AUT)',    code: 'isaemi',   phone: '522' },
    { name: 'Andreas Starzengruner (AUT)',  code: 'andsta',  phone: '523' },
    { name: 'Angela Perger (AUT)',   code: 'angper',phone: '525' },
    { name: 'Linda Bataeva (AUT)',  code: 'linbat',      phone: '68' },
    { name: 'Sandra Piniel (AUT)',   code: 'sanpin',   phone: '526' },
    { name: 'Nadine Br√ºnner (AUT)',   code: 'nadbru',     phone: '530' },
    { name: 'Kerstin Fr√∂hlich (AUT)', code: 'kerfro',  phone: '529' },
    { name: 'Morgain Ammerer (AUT)',     code: 'moramm',    phone: '528' },
    { name: 'Natascha Pakosta (AUT)',    code: 'natpak',   phone: '502' },
    { name: 'Stefan Schwertberger (AUT)',  code: 'stesch',  phone: '504' },
    { name: 'Nour Hammadi (AUT)',   code: 'bouham',phone: '508' },
    { name: 'Silke Pomper-Gabriel (AUT)',   code: 'silpom',phone: '517' },
    { name: 'Renate Leidenfrost (AUT)',   code: 'renlei',phone: '58' },
      { name: 'Tatjana Weinhold (SRB)',   code: 'tatwei',     phone: '601' },
    { name: 'Tatjana Babic (SRB)', code: 'tatbab',  phone: '602' },
    { name: 'Andrijana Debeljacki (SRB)',     code: 'anddeb',    phone: '604' },
    { name: 'Jaroslava Sic (SRB)',    code: 'jarsic',   phone: '606' },
    { name: 'Leposava Pavlociv (SRB)',  code: 'leppav',  phone: '607' },
    { name: 'Adriana Tomic (SRB)',   code: 'adrtom',phone: '608' },
    { name: 'Sanja Nikolic (SRB)',  code: 'sannik',      phone: '609' },
    { name: 'Aleksandar Babic (SRB)',   code: 'alebab',   phone: '610' },
    { name: 'Sara Goronja (SRB)',   code: 'sargor',     phone: '612' },
    { name: 'Andrej Goronja (SRB)', code: 'andgor',  phone: '613' },
    { name: 'Marko Radivojevic (SRB)',     code: 'marrad',    phone: '615' },
    { name: 'Dejan Milosevic (SRB)',    code: 'dejmil',   phone: '605' },
    { name: 'Iva Islambegovic (SRB)',  code: 'ivaisl',  phone: '616' },
    { name: 'Albert Djurakovac (SRB)',   code: 'albdju',phone: '618' },
    { name: 'Andre Vida (SRB)',   code: 'andvid',phone: '611' },
      { name: 'Miriam Palm (Verrechnung)',    code: 'mirpal',   phone: '42' },
    { name: 'Petra R√∂hrich (Verrechnung)',  code: 'petzwy',  phone: '92' },
    { name: 'Petra Lauer (Verrechnung)',   code: 'petlau',phone: '98' }
    

  ];

  function norm(s){ return (s||'').toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,''); }

  function initDurchwahlen(){
    const dwQuery = document.getElementById('dwQuery');
    const dwHits  = document.getElementById('dwHits');
    const dwOut   = document.getElementById('dwOut');
    const dwTbody = document.getElementById('dwTbody');

    if(!dwQuery || !dwHits || !dwOut || !dwTbody){
      console.warn('Durchwahlen: IDs nicht gefunden. Pr√ºfe View-HTML.');
      return;
    }

    // Durchwahlen Tabelle unten
    function renderDwTable(list){
      dwTbody.innerHTML = '';
      list.forEach(item=>{
        const tr = document.createElement('tr');
      tr.innerHTML = `
  <td style="padding:10px 8px;border-bottom:1px solid var(--border)">${item.name}</td>
  <td style="padding:10px 8px;border-bottom:1px solid var(--border)">${item.code||''}</td>
  <td style="padding:10px 8px;border-bottom:1px solid var(--border)">${item.phone||''}</td>
  <td style="padding:10px 8px;border-bottom:1px solid var(--border);text-align:right">
    <button class="btn" data-copy="${item.phone||''}">Kopieren</button>
  </td>
`;
        // Name klickbar ‚Üí Detail
        tr.children[0].style.cursor='pointer';
        tr.children[0].onclick = ()=> showDw(item);
        // Kopieren
        tr.querySelector('[data-copy]')?.addEventListener('click', (ev)=>{
          const num = ev.currentTarget.getAttribute('data-copy');
          if(!num) return;
          navigator.clipboard.writeText(num);
          ev.currentTarget.textContent='Kopiert!';
          setTimeout(()=>ev.currentTarget.textContent='Kopieren', 900);
        });
        dwTbody.appendChild(tr);
      });
    }

    // Treffer oben links
    function renderDwHits(list){
      if(!list.length){
        dwHits.innerHTML = '<span class="muted">Keine Treffer.</span>';
        return;
      }
      const wrap = document.createElement('div');
      wrap.style.display='flex'; wrap.style.flexWrap='wrap'; wrap.style.gap='8px';
      list.forEach(item=>{
        const b = document.createElement('button');
        b.className='chip';  // nutzt deinen vorhandenen .chip Style
        b.textContent = item.name;
        b.onclick = ()=> showDw(item);
        wrap.appendChild(b);
      });
      dwHits.innerHTML=''; dwHits.appendChild(wrap);
    }

    // Detail rechts
    function showDw(item){
      dwOut.classList.remove('muted');
      dwOut.innerHTML = `
        <div style="font-weight:600;margin-bottom:6px">${item.name}</div>
        <div class="phone" style="margin-bottom:10px">${item.phone||''}</div>
        <button class="btn" id="copyDw">Nummer kopieren</button>
      `;
      document.getElementById('copyDw')?.addEventListener('click', ()=>{
        if(item.phone){
          navigator.clipboard.writeText(item.phone);
          const btn = document.getElementById('copyDw');
          btn.textContent='Kopiert!';
          setTimeout(()=>btn.textContent='Nummer kopieren', 900);
        }
      });
    }

    // Suche
    dwQuery.addEventListener('input', e=>{
      const q = norm(e.target.value);
      if(!q){
        dwHits.innerHTML = '<span class="muted">Bitte zuerst mindestens einen Buchstaben eingeben.</span>';
        return;
      }
      const hits = DW.filter(d => norm(d.name).startsWith(q));
      renderDwHits(hits);
    });

    // Initial: Tabelle f√ºllen
    renderDwTable(DW);
  }

  // Starte erst, wenn DOM fertig ist
  if (document.readyState !== 'loading') initDurchwahlen();
  else document.addEventListener('DOMContentLoaded', initDurchwahlen);
})();

// Gespr√§chsablauf vorbereiten
setupFlowClicks();
renderFlowDetail(null);   // Platzhalteranzeige
markAllDialogBlocks();    // Mitarbeiter grau + Kunden wei√ü einf√§rben
paintListByRole(document.getElementById('flowStandard'));

/* ===== Tabs: allgemeines Umschalten per data-view (falls du nichts eigenes hast) ===== */
(function wireTabs(){
  const tabs  = document.querySelectorAll('.tabs .tab');
  const views = {
    self: document.getElementById('view-self'),
    sn:   document.getElementById('view-sn'),
    htel: document.getElementById('view-htel'),
    flow: document.getElementById('view-flow'),
    docs: document.getElementById('view-docs'),
  };
  function show(viewName){
    // Tabs-Zustand
    tabs.forEach(t=>t.classList.toggle('is-active', t.dataset.view===viewName));
    // Views-Zustand
    Object.values(views).forEach(v=> v && v.classList.remove('is-active'));
    views[viewName]?.classList.add('is-active');
    // Hash (optional)
    try{ history.replaceState(null,'', '#'+viewName); }catch{}
  }
  tabs.forEach(t=> t.addEventListener('click', ()=> show(t.dataset.view)));
  // initial
  const start = (location.hash||'#self').slice(1);
  show(views[start] ? start : 'self');
})();

/* ===== Arbeitsanweisungen (lokal, Passwort "A1qilo") ===== */
const DOCS_PASSWORD = "A1qilo";

const $id = (x)=>document.getElementById(x);
const docsStatus = $id('docsStatus');
const docsPw     = $id('docsPw');
const btnLogin   = $id('docsLogin');
const btnLogout  = $id('docsLogout');
const adminBar   = $id('docsAdmin');
const fileInput  = $id('docsUpload');
const btnAdd     = $id('docsAdd');
const listEl     = $id('docsList');

let isAdmin = false;
let db; // IndexedDB

// --- IndexedDB √∂ffnen/erstellen ---
function openDB(){
  return new Promise((resolve,reject)=>{
    const req = indexedDB.open('arbeitsanweisungenDB', 1);
    req.onupgradeneeded = (e)=>{
      const db = e.target.result;
      if(!db.objectStoreNames.contains('docs')){
        const store = db.createObjectStore('docs', { keyPath: 'id', autoIncrement: true });
        store.createIndex('created','created');
      }
    };
    req.onsuccess = ()=>resolve(req.result);
    req.onerror   = ()=>reject(req.error);
  });
}
function getAllDocs(){
  return new Promise((resolve,reject)=>{
    const tx = db.transaction('docs','readonly');
    const st = tx.objectStore('docs');
    const arr = [];
    st.openCursor().onsuccess = (e)=>{
      const cur = e.target.result;
      if(cur){ arr.push(cur.value); cur.continue(); }
      else resolve(arr.sort((a,b)=>b.created-a.created)); // neueste zuerst
    };
    tx.onerror = ()=>reject(tx.error);
  });
}
function addDoc(name, blob){
  return new Promise((resolve,reject)=>{
    const tx = db.transaction('docs','readwrite');
    const st = tx.objectStore('docs');
    const req = st.add({ name, blob, created: Date.now() });
    req.onsuccess = ()=>resolve(req.result);
    req.onerror   = ()=>reject(req.error);
  });
}
function deleteDoc(id){
  return new Promise((resolve,reject)=>{
    const tx = db.transaction('docs','readwrite');
    const st = tx.objectStore('docs');
    const req = st.delete(id);
    req.onsuccess = ()=>resolve();
    req.onerror   = ()=>reject(req.error);
  });
}

// --- UI updaten & Liste rendern ---
function updateDocsUI(){
  if(!docsStatus) return; // View evtl. noch nicht im DOM
  docsStatus.textContent = isAdmin ? "Adminmodus aktiv" : "Nur-Lesen";
  adminBar.style.display   = isAdmin ? "flex" : "none";
  btnLogin.style.display   = isAdmin ? "none" : "inline-block";
  docsPw.style.display     = isAdmin ? "none" : "inline-block";
  btnLogout.style.display  = isAdmin ? "inline-block" : "none";
}
async function renderDocs(){
  if(!listEl) return;
  const docs = await getAllDocs();
  listEl.innerHTML = "";
  if(!docs.length){
    listEl.innerHTML = `<li class="muted">Noch keine Dokumente hochgeladen.</li>`;
    return;
  }
  docs.forEach(doc=>{
    const url = URL.createObjectURL(doc.blob);
    const li = document.createElement('li');
    li.className = 'docs-item';
    li.innerHTML = `
      <a href="${url}" target="_blank" rel="noopener">${doc.name}</a>
      <div class="docs-actions">
        <a class="btn" href="${url}" download="${doc.name}">Download</a>
        ${isAdmin ? `<button class="btn btn-danger" data-del="${doc.id}">L√∂schen</button>` : ``}
      </div>
    `;
    listEl.appendChild(li);
  });
  if(isAdmin){
    listEl.querySelectorAll('[data-del]').forEach(btn=>{
      btn.onclick = async ()=>{
        if(confirm("Dieses Dokument wirklich l√∂schen?")){
          await deleteDoc(Number(btn.dataset.del));
          renderDocs();
        }
      };
    });
  }
}

// --- Login/Logout/Upload Events ---
btnLogin?.addEventListener('click', ()=>{
  const pw = docsPw.value.trim();
  if(pw === DOCS_PASSWORD){
    isAdmin = true; docsPw.value = "";
    updateDocsUI(); renderDocs();
  }else{
    alert("Falsches Passwort.");
  }
});
btnLogout?.addEventListener('click', ()=>{
  isAdmin = false;
  updateDocsUI(); renderDocs();
});
btnAdd?.addEventListener('click', async ()=>{
  if(!isAdmin){ alert("Nur mit Passwort m√∂glich."); return; }
  if(!fileInput.files?.length){ alert("Bitte PDFs ausw√§hlen."); return; }
  for(const f of fileInput.files){
    if(f.type !== 'application/pdf'){ alert(`${f.name} ist kein PDF.`); continue; }
    await addDoc(f.name, f);
  }
  fileInput.value = ""; renderDocs();
});

// --- Start der Docs-View ---
(async function docsInit(){
  try{
    db = await openDB();
    await renderDocs();
    updateDocsUI();
  }catch(e){
    console.error("IndexedDB Fehler:", e);
    if(listEl) listEl.innerHTML = `<li class="muted">Speicherfehler. Bitte Browser pr√ºfen.</li>`;
  }
})();
// --- Tabs generisch schalten (kennt automatisch auch "dw") ---
function setupTabs(){
  const tabs = document.querySelectorAll('.tabs .tab');
  const views = document.querySelectorAll('.view');

  function showView(name){
    tabs.forEach(b => b.classList.toggle('is-active', b.dataset.view === name));
    views.forEach(v => v.style.display = 'none');
    const v = document.getElementById('view-' + name);
    if (v) v.style.display = 'block';
  }

  tabs.forEach(btn=>{
    btn.addEventListener('click', ()=> showView(btn.dataset.view));
  });

  // beim Laden eine aktive View zeigen
  const active = document.querySelector('.tabs .tab.is-active')?.dataset.view
              || tabs[0]?.dataset.view;
  if (active) showView(active);
}

// nach deiner bisherigen init() aufrufen:
if (document.readyState !== 'loading') setupTabs();
else document.addEventListener('DOMContentLoaded', setupTabs);

</script>
</body>
</html>